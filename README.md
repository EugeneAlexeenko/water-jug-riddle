# Water Jug Riddle

![Build Status](https://github.com/EugeneAlexeenko/water-jug-riddle/actions/workflows/ci.yml/badge.svg)

## Description

This is a simple API that solves the classic water jug riddle from the movie Die Hard 3. [YouTube](https://www.youtube.com/watch?v=2vdF6NASMiE)

The riddle is as follows: You have a 3-gallon jug and a 5-gallon jug, and you need to measure out exactly 4 gallons of water.

**NOTE** This project is intentionally over-engineered to demonstrate production best practices.

## Features

1. NestJS App with a single endpoint that solves the riddle
2. Autogenerated Swagger API documentation
3. Error handling and input validation
4. Unit tests
5. E2E tests
6. In-memory Cache for storing the results of the riddle
7. CI pipeline to run linting, unit tests, and e2e tests

## Quick start

1. Clone the repository
2. Run `npm install`
3. Run `npm run start:dev`
4. Open [http://localhost:3000/api/swagger](http://localhost:3000/api/swagger) in your browser and start playing with the API
5. Alternatively, you can use any other tool for API testing, see `curl` example below:

```bash
curl -X 'POST' \
  'http://localhost:3000/api/water-jug-riddle/solution' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "jug1Capacity": 3,
  "jug2Capacity": 5,
  "targetVolume": 4
}'
```

6. Examples of use:

- solvable riddle:

  request payload:

  ```json
  {
    "jug1Capacity": 3,
    "jug2Capacity": 5,
    "targetVolume": 4
  }
  ```

  response:

  ```json
  {
    "solution": [
      {
        "step": 1,
        "jug2Volume": 5,
        "jug1Volume": 0,
        "action": "Fill Jug2"
      },
      {
        "step": 2,
        "jug2Volume": 2,
        "jug1Volume": 3,
        "action": "Transfer from Jug2 to Jug1"
      },
      {
        "step": 3,
        "jug2Volume": 2,
        "jug1Volume": 0,
        "action": "Empty Jug1"
      },
      {
        "step": 4,
        "jug2Volume": 0,
        "jug1Volume": 2,
        "action": "Transfer from Jug2 to Jug1"
      },
      {
        "step": 5,
        "jug2Volume": 5,
        "jug1Volume": 2,
        "action": "Fill Jug2"
      },
      {
        "step": 6,
        "jug2Volume": 4,
        "jug1Volume": 3,
        "action": "Transfer from Jug2 to Jug1",
        "status": "Solved"
      }
    ]
  }
  ```

- unsolvable riddle:

  request payload:

  ```json
  {
    "jug1Capacity": 2,
    "jug2Capacity": 6,
    "targetVolume": 5
  }
  ```

  response:

  ```json
  {
    "solution": "Solution does not exist. Target volume: 5 is not a multiple of GCD(2, 6)"
  }
  ```

## Useful development commands

```bash
# 1. installation
$ npm install

# 2. running the app
# development mode
$ npm run start

# watch mode
$ npm run start:dev

# production mode
$ npm run start:prod

# 3. test
# unit tests
$ npm run test

# e2e tests
$ npm run test:e2e

# test coverage
$ npm run test:cov
```

## Technical Decisions

- [Nest](https://github.com/nestjs/nest) base framework.
- [Swagger](https://swagger.io/) for API documentation.
- [Jest](https://jestjs.io/) for unit and e2e tests.
- [In-memory cache](https://docs.nestjs.com/techniques/caching) to store the results of the riddle.

## Algorithmic approach

For the algorithmic approach, I used an algebraic solution to the problem, since it is the most efficient way to solve it.

The problem can be modeled by means of the Diophantine equation of the form `mx + ny = d` which is solvable if and only if `gcd(m, n)` divides `d`

Time Complexity: `O(N + M)`
Auxiliary Space: `O(1)`

Detailed teorethical explanation can be found in this [paper](http://web.mit.edu/neboat/Public/6.042/numbertheory1.pdf)
